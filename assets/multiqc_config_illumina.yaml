report_comment: >
    This report has been generated by the <a href="https://github.com/nf-core/viralrecon" target="_blank">nf-core/viralrecon</a>
    analysis pipeline. For information about how to interpret these results, please see the
    <a href="https://github.com/nf-core/viralrecon" target="_blank">documentation</a>.

data_format: 'yaml'

skip_generalstats: true

max_table_rows: 10000

run_modules:
    - custom_content
    - fastqc
    - fastp
    - kraken
    - bowtie2
    - samtools
    - picard
    - mosdepth
    - bcftools
    - snpeff
    - quast
    - cutadapt

module_order:
    - fastqc:
        name: 'PREPROCESS: FastQC (raw reads)'
        anchor: 'fastqc_raw'
        info: 'This section of the report shows FastQC results for the raw reads before adapter trimming.'
        path_filters:
            - './fastqc/*.zip'
    - fastp:
        name: 'PREPROCESS: fastp (adapter trimming)'
        info: 'This section of the report shows fastp results for reads after adapter and quality trimming.'
    - kraken:
        name: 'PREPROCESS: Kraken 2'
        info: 'This section of the report shows Kraken 2 classification results for reads after adapter trimming with fastp.'
    - bowtie2:
        name: 'VARIANTS: Bowtie 2'
        info: 'This section of the report shows Bowtie 2 mapping results for reads after adapter trimming and quality trimming.'
    - samtools:
        name: 'VARIANTS: SAMTools (raw)'
        anchor: 'samtools_bowtie2'
        info: 'This section of the report shows SAMTools counts/statistics after mapping with Bowtie 2.'
        path_filters:
            - './bowtie2/*'
    - samtools:
        name: 'VARIANTS: SAMTools (iVar)'
        anchor: 'samtools_ivar'
        info: 'This section of the report shows SAMTools counts/statistics after primer sequence removal with iVar.'
        path_filters:
            - './ivar_trim/*'
    - samtools:
        name: 'VARIANTS: SAMTools (MarkDuplicates)'
        anchor: 'samtools_markduplicates'
        info: 'This section of the report shows SAMTools counts/statistics after duplicate removal with picard MarkDuplicates.'
        path_filters:
            - './picard_markduplicates/*'
    - picard:
        name: 'VARIANTS: Picard Metrics'
        info: 'This section of the report shows picard CollectMultipleMetrics and MarkDuplicates results after mapping (if "--protocol amplicon" this will be after primer sequence removal with iVar).'
    - mosdepth:
        name: 'VARIANTS: mosdepth'
        info: 'This section of the report shows genome-wide coverage metrics generated by mosdepth.'
    - bcftools:
        name: 'VARIANTS: BCFTools (iVar)'
        anchor: 'bcftools_ivar'
        info: 'This section of the report shows BCFTools stats results for variants called by iVar.'
        path_filters:
            - './variants_ivar/*.txt'
    - snpeff:
        name: 'VARIANTS: SnpEff (iVar)'
        anchor: 'snpeff_ivar'
        info: 'This section of the report shows SnpEff results for variants called by iVar.'
        path_filters:
            - './variants_ivar/*.csv'
    - quast:
        name: 'VARIANTS: QUAST (iVar)'
        anchor: 'quast_ivar'
        info: 'This section of the report shows QUAST results for consensus sequences generated from variants with iVar.'
        path_filters:
            - './variants_ivar/*.tsv'
    - bcftools:
        name: 'VARIANTS: BCFTools (BCFTools)'
        anchor: 'bcftools_bcftools'
        info: 'This section of the report shows BCFTools stats results for variants called by BCFTools.'
        path_filters:
            - './variants_bcftools/*.txt'
    - snpeff:
        name: 'VARIANTS: SnpEff (BCFTools)'
        anchor: 'snpeff_bcftools'
        info: 'This section of the report shows SnpEff results for variants called by BCFTools.'
        path_filters:
            - './variants_bcftools/*.csv'
    - quast:
        name: 'VARIANTS: QUAST (BCFTools)'
        anchor: 'quast_bcftools'
        info: 'This section of the report shows QUAST results for consensus sequence generated from BCFTools variants.'
        path_filters:
            - './variants_bcftools/*.tsv'
    - cutadapt:
        name: 'ASSEMBLY: Cutadapt (primer trimming)'
        info: 'This section of the report shows Cutadapt results for reads after primer sequence trimming.'
    - quast:
        name: 'ASSEMBLY: QUAST (SPAdes)'
        anchor: 'quast_spades'
        info: 'This section of the report shows QUAST results from SPAdes de novo assembly.'
        path_filters:
            - './assembly_spades/*.tsv'
    - quast:
        name: 'ASSEMBLY: QUAST (Unicycler)'
        anchor: 'quast_unicycler'
        info: 'This section of the report shows QUAST results from Unicycler de novo assembly.'
        path_filters:
            - './assembly_unicycler/*.tsv'
    - quast:
        name: 'ASSEMBLY: QUAST (minia)'
        anchor: 'quast_minia'
        info: 'This section of the report shows QUAST results from minia de novo assembly.'
        path_filters:
            - './assembly_minia/*.tsv'

report_section_order:
    summary_assembly_metrics:
      before: summary_variants_metrics
    ivar_variants:
        before: mosdepth
    software_versions:
        order: -1001
    nf-core-viralrecon-summary:
        order: -1002

bcftools:
    collapse_complementary_changes: true

custom_plot_config:
    picard_insert_size:
        cpswitch_c_active: False
        smooth_points: 1000

extra_fn_clean_exts:
    - '.markduplicates'
    - '.unclassified'

# See https://github.com/ewels/MultiQC_TestData/blob/master/data/custom_content/with_config/table_headerconfig/multiqc_config.yaml
custom_data:
    summary_variants_metrics:
        section_name: 'Variant calling metrics'
        description: 'generated by the nf-core/viralrecon pipeline'
        plot_type: 'table'
        headers:        
            '# Input reads':
                description: 'Total number of reads in raw fastq file'
                format: '{:,.0f}'
            '% Non-host reads (Kraken 2)':
                description: 'Total number of non-host reads identified by Kraken2'
                format: '{:,.2f}'
            '# Trimmed reads (fastp)':
                description: 'Total number of reads remaining after adapter/quality trimming with fastp'
                format: '{:,.0f}'
            '# Mapped reads':
                description: 'Total number of Bowtie2 mapped reads relative to the viral genome'
                format: '{:,.0f}'
            '% Mapped reads':
                description: 'Percentage of Bowtie2 mapped reads relative to the viral genome'
                format: '{:,.2f}'
            '# Trimmed reads (iVar)':
                description: 'Total number of reads remaining after primer trimming with iVar'
                format: '{:,.0f}'
            '# Duplicate reads':
                description: 'Total number of duplicate marked reads with picard MarkDuplicates'
                format: '{:,.0f}'
            '# Reads after MarkDuplicates':
                description: 'Total number of reads after running picard MarkDuplicates'
                format: '{:,.0f}'
            'Insert size mean':
                description: 'Mean paired-end read insert size calculated by picard CollectMultipleMetrics'
                format: '{:,.2f}'
            'Insert size std dev':
                description: 'Standard deviation of paired-end read insert size calculated by picard CollectMultipleMetrics'
                format: '{:,.2f}'
            'Coverage median':
                description: 'Median coverage calculated by mosdepth'
                format: '{:,.2f}'
            '% Coverage > 1x':
                description: 'Coverage > 1x calculated by mosdepth'
                format: '{:,.2f}'
            '% Coverage > 10x':
                description: 'Coverage > 10x calculated by mosdepth'
                format: '{:,.2f}'
            '# SNPs (iVar)':
                description: 'Total number of SNPs called by iVar'
                format: '{:,.0f}'
            '# INDELs (iVar)':
                description: 'Total number of INDELs called by iVar'
                format: '{:,.0f}'
            '# Missense variants (iVar)':
                description: 'Total number of variants called by iVar and identified as missense mutations with SnpEff'
                format: '{:,.0f}'
            '# Ns per 100kb consensus (iVar)':
                description: 'Number of N bases per 100kb in consensus sequence generated by iVar'
                format: '{:,.2f}'
            '# SNPs (BCFTools)':
                description: 'Total number of SNPs called by BCFTools'
                format: '{:,.0f}'
            '# INDELs (BCFTools)':
                description: 'Total number of INDELs called by BCFTools'
                format: '{:,.0f}'
            '# Missense variants (BCFTools)':
                description: 'Total number of variants called by BCFTools and identified as missense mutations with SnpEff'
                format: '{:,.0f}'
            '# Ns per 100kb consensus (BCFTools)':
                description: 'Number of N bases per 100kb in consensus sequence generated by BCFTools'
                format: '{:,.2f}'
        pconfig:
            id: 'summary_variants_metrics_plot'
            table_title: 'Variant calling metrics'
            namespace: 'Variant calling metrics'
            only_defined_headers: False
            format: '{:.0f}'
    summary_assembly_metrics:
        section_name: 'De novo assembly metrics'
        description: 'generated by the nf-core/viralrecon pipeline'
        plot_type: 'table'
        headers:
            '# Input reads':
                description: 'Total number of reads in raw fastq file'
                format: '{:,.0f}'
            '# Trimmed reads (Cutadapt)':
                description: 'Total number of reads remaining after adapter/quality trimming with fastp'
                format: '{:,.0f}'
            '% Non-host reads (Kraken 2)':
                description: 'Total number of non-host reads identified by Kraken2'
                format: '{:,.2f}'
            '# Contigs (SPAdes)':
                description: 'Total number of contigs in SPAdes assembly as calculated by QUAST'
                format: '{:,.0f}'
            'Largest contig (SPAdes)':
                description: 'Size of largest contig in SPAdes assembly as calculated by QUAST'
                format: '{:,.0f}'
            '% Genome fraction (SPAdes)':
                description: '% genome fraction for SPAdes assembly as calculated by QUAST'
                format: '{:,.2f}'
            'N50 (SPAdes)':
                description: 'N50 metric for SPAdes assembly as calculated by QUAST'
                format: '{:,.2f}'
            '# Contigs (Unicycler)':
                description: 'Total number of contigs in Unicycler assembly as calculated by QUAST'
                format: '{:,.0f}'
            'Largest contig (Unicycler)':
                description: 'Size of largest contig in Unicycler assembly as calculated by QUAST'
                format: '{:,.0f}'
            '% Genome fraction (Unicycler)':
                description: '% genome fraction for Unicycler assembly as calculated by QUAST'
                format: '{:,.2f}'
            'N50 (Unicycler)':
                description: 'N50 metric for Unicycler assembly as calculated by QUAST'
                format: '{:,.2f}'
            '# Contigs (minia)':
                description: 'Total number of contigs in minia assembly as calculated by QUAST'
                format: '{:,.0f}'
            'Largest contig (minia)':
                description: 'Size of largest contig in minia assembly as calculated by QUAST'
                format: '{:,.0f}'
            '% Genome fraction (minia)':
                description: '% genome fraction for minia assembly as calculated by QUAST'
                format: '{:,.2f}'
            'N50 (minia)':
                description: 'N50 metric for minia assembly as calculated by QUAST'
                format: '{:,.2f}'
        pconfig:
            id: 'summary_assembly_metrics_plot'
            table_title: 'De novo assembly metrics'
            namespace: 'De novo assembly metrics'
            only_defined_headers: False
            format: '{:.0f}'
    fail_mapped_samples:
        section_name: 'WARNING: Fail Alignment Check'
        description: "List of samples that failed the Bowtie2 minimum mapped reads threshold specified via the '--min_mapped_reads' parameter, and hence were ignored for the downstream processing steps."
        plot_type: 'table'
        pconfig:
            id: 'fail_mapped_samples_table'
            table_title: 'Samples failed mapped read threshold'
            namespace: 'Samples failed mapping read threshold'
            format: '{:,.0f}'

# # Customise the module search patterns to speed up execution time
# #  - Skip module sub-tools that we are not interested in
# #  - Replace file-content searching with filename pattern searching
# #  - Don't add anything that is the same as the MultiQC default
# # See https://multiqc.info/docs/#optimise-file-search-patterns for details
sp:
    fastp:
        fn: '*.fastp.json'
    bowtie2:
        fn: '*.bowtie2.log'
    mosdepth/global_dist:
        fn: '*.global.dist.txt'
    cutadapt:
        fn: '*.cutadapt.log'
    picard/alignment_metrics:
        fn: '*.alignment_summary_metrics'
    picard/insertsize:
        fn: '*.insert_size_metrics'
    picard/markdups:
        fn: '*.MarkDuplicates.metrics.txt'
    picard/wgs_metrics:
        skip: true
    picard/basedistributionbycycle:
        skip: true
    picard/gcbias:
        skip: true
    picard/hsmetrics:
        skip: true
    picard/oxogmetrics:
        skip: true
    picard/pcr_metrics:
        skip: true
    picard/quality_by_cycle:
        skip: true
    picard/quality_score_distribution:
        skip: true
    picard/quality_yield_metrics:
        skip: true
    picard/rnaseqmetrics:
        skip: true
    picard/rrbs_metrics:
        skip: true
    picard/sam_file_validation:
        skip: true
    picard/variant_calling_metrics:
        skip: true
